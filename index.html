<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ Kalori Pro Premium</title>
    <meta name="theme-color" content="#8B5CF6">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75'>ğŸ</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <style>
:root{--primary:#8B5CF6;--secondary:#EC4899;--accent:#10B981;--danger:#EF4444;--warning:#F59E0B;--bg:#F9FAFB;--card:#FFF;--text:#1F2937;--text-sec:#6B7280;--border:#E5E7EB}
[data-theme="dark"]{--primary:#A78BFA;--bg:#1F2937;--card:#374151;--text:#F9FAFB;--text-sec:#D1D5DB;--border:#4B5563}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;padding-bottom:80px;transition:background 0.3s,color 0.3s}
.premium-badge{display:inline-flex;align-items:center;gap:6px;background:linear-gradient(135deg,#FFD700,#FFA500);color:#000;padding:6px 12px;border-radius:50px;font-size:11px;font-weight:700;text-transform:uppercase}
.header{background:linear-gradient(135deg,var(--primary),#6366F1);padding:20px;color:white;border-radius:0 0 30px 30px;box-shadow:0 10px 30px rgba(139,92,246,0.3);position:sticky;top:0;z-index:100}
.header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.greeting h1{font-size:24px;font-weight:700;margin-bottom:4px}
.header-actions{display:flex;gap:10px}
.icon-btn{width:42px;height:42px;border-radius:14px;border:none;background:rgba(255,255,255,0.2);color:white;font-size:20px;cursor:pointer;transition:0.3s}
.icon-btn:active{transform:scale(0.95)}
.calorie-summary{background:var(--card);margin:-40px 20px 20px;border-radius:24px;padding:25px;box-shadow:0 10px 40px rgba(0,0,0,0.08)}
.streak{display:inline-flex;align-items:center;gap:6px;background:linear-gradient(135deg,#FEF3C7,#FDE68A);color:#92400E;padding:8px 16px;border-radius:50px;font-size:13px;font-weight:600;margin-bottom:20px}
.ring-wrapper{position:relative;width:180px;height:180px;margin:0 auto 15px}
.ring-wrapper svg{transform:rotate(-90deg)}
.ring-wrapper circle{fill:none;stroke-width:14}
.ring-bg{stroke:#F3F4F6}
.ring-progress{stroke:url(#grad);stroke-linecap:round;transition:0.8s}
.ring-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
.ring-value{font-size:42px;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.macros{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:25px}
.macro{background:var(--bg);padding:18px 12px;border-radius:16px;text-align:center}
.macro-icon{font-size:28px;margin-bottom:8px}
.macro-val{font-size:20px;font-weight:700;margin-bottom:4px}
.macro-bar{height:6px;background:#E5E7EB;border-radius:10px;overflow:hidden;margin-top:8px}
.macro-fill{height:100%;border-radius:10px;transition:0.5s}
.protein{background:linear-gradient(90deg,#EF4444,#DC2626)}
.carbs{background:linear-gradient(90deg,#F59E0B,#D97706)}
.fat{background:linear-gradient(90deg,#8B5CF6,#7C3AED)}
.container{max-width:600px;margin:0 auto;padding:0 20px 20px}
.quick-actions{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:25px}
.action{background:var(--card);padding:20px;border-radius:20px;box-shadow:0 4px 20px rgba(0,0,0,0.06);cursor:pointer;transition:0.3s;text-align:center}
.action:active{transform:scale(0.98)}
.action.primary{background:linear-gradient(135deg,var(--primary),#7C3AED);color:white}
.action.blue{background:linear-gradient(135deg,#3B82F6,#2563EB);color:white}
.action.green{background:linear-gradient(135deg,#10B981,#059669);color:white}
.action-icon{font-size:36px;margin-bottom:12px}
.card{background:var(--card);border-radius:20px;padding:20px;margin-bottom:15px;box-shadow:0 4px 20px rgba(0,0,0,0.06)}
.card-title{font-size:18px;font-weight:700;margin-bottom:18px}
.meal-sel{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:20px}
.meal-opt{padding:16px 8px;background:var(--bg);border:2px solid transparent;border-radius:16px;cursor:pointer;text-align:center;transition:0.3s}
.meal-opt.sel{background:linear-gradient(135deg,var(--primary),#7C3AED);color:white;box-shadow:0 4px 15px rgba(139,92,246,0.3)}
.upload-methods{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px}
.upload-method{border:3px dashed var(--border);border-radius:16px;padding:30px 15px;text-align:center;cursor:pointer;transition:0.3s;background:var(--bg)}
.upload-method:hover{border-color:var(--primary);background:rgba(139,92,246,0.05)}
.hidden{display:none}
.preview{margin-top:20px}
.preview.show{display:block}
.preview-img{width:100%;max-height:400px;object-fit:cover;border-radius:20px;margin-bottom:15px}
.btn{width:100%;padding:18px;border:none;border-radius:16px;font-size:16px;font-weight:700;cursor:pointer;transition:0.3s}
.btn-primary{background:linear-gradient(135deg,var(--primary),#7C3AED);color:white}
.btn-success{background:linear-gradient(135deg,#10B981,#059669);color:white}
.btn-danger{background:#FEE2E2;color:#DC2626}
.btn:active{transform:scale(0.98)}
.loading{display:none;text-align:center;padding:40px}
.loading.show{display:block}
.spinner{width:60px;height:60px;margin:0 auto 20px;border:5px solid #F3F4F6;border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.result{display:none;margin-top:20px}
.result.show{display:block}
.result-head{display:flex;justify-content:space-between;margin-bottom:20px}
.result-name{font-size:24px;font-weight:800;flex:1}
.result-score{background:linear-gradient(135deg,#FBBF24,#F59E0B);color:white;padding:10px 18px;border-radius:50px;font-size:16px;font-weight:700}
.nutrition{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px}
.nut-item{background:var(--bg);padding:16px;border-radius:16px;text-align:center}
.nut-val{font-size:24px;font-weight:700;margin-bottom:4px}
.ai-box{background:linear-gradient(135deg,#DBEAFE,#BFDBFE);padding:18px;border-radius:16px;margin-bottom:20px}
.ai-head{display:flex;align-items:center;gap:8px;font-weight:700;color:#1E40AF;margin-bottom:10px;font-size:15px}
.food-card{background:var(--card);border-radius:16px;padding:16px;margin-bottom:10px;display:flex;gap:16px;box-shadow:0 2px 10px rgba(0,0,0,0.04)}
.food-img-wrap{width:80px;height:80px;flex-shrink:0;border-radius:14px;overflow:hidden;background:linear-gradient(135deg,#F3F4F6,#E5E7EB);display:flex;align-items:center;justify-content:center}
.food-img{width:100%;height:100%;object-fit:cover}
.food-placeholder{font-size:36px}
.food-info{flex:1}
.food-name{font-size:16px;font-weight:700;margin-bottom:8px}
.food-macros{display:flex;gap:12px;font-size:12px;color:var(--text-sec);margin-bottom:6px}
.food-score{display:inline-flex;align-items:center;gap:4px;background:linear-gradient(135deg,#FEF3C7,#FDE68A);color:#92400E;padding:4px 10px;border-radius:50px;font-size:12px;font-weight:700}
.food-cal{font-size:22px;font-weight:800;background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.del-btn{width:38px;height:38px;border-radius:50%;border:none;background:#FEE2E2;color:#DC2626;font-size:18px;cursor:pointer}
.water-glasses{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin:15px 0}
.glass{aspect-ratio:1;background:white;border-radius:8px;cursor:pointer;transition:0.3s;font-size:24px;display:flex;align-items:center;justify-content:center;border:2px solid rgba(59,130,246,0.3)}
.glass.filled{background:#3B82F6;border-color:#2563EB}
.weight-entry{display:grid;grid-template-columns:1fr auto;gap:12px;margin-bottom:15px}
.input{padding:14px 16px;border:2px solid var(--border);border-radius:12px;font-size:16px;font-family:inherit;background:var(--card);color:var(--text)}
.input:focus{outline:none;border-color:var(--primary)}
.stat-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px}
.stat{background:var(--bg);padding:16px;border-radius:16px;text-align:center}
.stat-val{font-size:28px;font-weight:800;color:var(--primary);margin-bottom:4px}
.stat-label{font-size:13px;color:var(--text-sec)}
.badge{display:inline-flex;flex-direction:column;align-items:center;padding:20px;background:var(--bg);border-radius:16px;margin:5px}
.badge-icon{font-size:48px;margin-bottom:8px}
.badge-name{font-size:14px;font-weight:700;margin-bottom:4px}
.badge.locked{opacity:0.4}
.fav-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.fav-card{background:var(--bg);padding:16px;border-radius:16px;cursor:pointer;transition:0.3s}
.fav-card:active{transform:scale(0.98)}
.recipe-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.recipe-card{background:var(--card);border-radius:16px;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,0.06);cursor:pointer}
.recipe-img{width:100%;height:120px;background:linear-gradient(135deg,#F3F4F6,#E5E7EB);display:flex;align-items:center;justify-content:center;font-size:48px}
.recipe-info{padding:12px}
.modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:9999;padding:20px;overflow-y:auto}
.modal.show{display:flex;align-items:center;justify-content:center}
.modal-content{background:var(--card);border-radius:24px;max-width:500px;width:100%;max-height:90vh;overflow-y:auto}
.modal-header{position:sticky;top:0;background:var(--card);padding:20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.close-btn{width:40px;height:40px;border-radius:50%;border:none;background:var(--bg);font-size:20px;cursor:pointer}
.modal-body{padding:20px}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--border);padding:8px 0;display:flex;justify-content:space-around;z-index:1000;box-shadow:0 -4px 20px rgba(0,0,0,0.06)}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px;cursor:pointer;color:var(--text-sec);border:none;background:none;transition:0.3s}
.nav-item.active{color:var(--primary)}
.nav-icon{font-size:24px}
.nav-label{font-size:10px;font-weight:600}
.tab{display:none}
.tab.active{display:block}
.empty{text-align:center;padding:60px 20px}
.empty-icon{font-size:72px;margin-bottom:20px}
.toggle{position:relative;width:60px;height:30px;background:#E5E7EB;border-radius:15px;cursor:pointer;transition:0.3s}
.toggle.on{background:var(--primary)}
.toggle-btn{position:absolute;top:3px;left:3px;width:24px;height:24px;background:white;border-radius:50%;transition:0.3s}
.toggle.on .toggle-btn{left:33px}
.reminder-item{display:flex;justify-content:space-between;align-items:center;padding:15px;background:var(--bg);border-radius:12px;margin-bottom:10px}
.profile-pic{width:120px;height:120px;border-radius:50%;border:4px solid var(--primary);object-fit:cover;margin:0 auto 15px;cursor:pointer;display:block}
.chart-container{position:relative;height:250px;margin-top:20px}
.diet-tag{display:inline-block;padding:6px 12px;background:var(--primary);color:white;border-radius:50px;font-size:12px;margin:4px}
.section-title{font-size:20px;font-weight:700;margin:25px 0 15px}
    </style>
</head>
<body>
<div class="header">
  <div class="header-top">
    <div class="greeting">
      <h1>Kalori Pro <span class="premium-badge">ğŸ‘‘ Premium</span></h1>
      <p id="date">BugÃ¼n harika bir gÃ¼n!</p>
    </div>
    <div class="header-actions">
      <button class="icon-btn" onclick="toggleDarkMode()">ğŸŒ™</button>
      <button class="icon-btn" onclick="switchTab('settings')">âš™ï¸</button>
    </div>
  </div>
</div>

<div class="container">
  <div id="homeTab" class="tab active">
    <div class="calorie-summary">
      <div class="streak">ğŸ”¥ <span id="streak">0</span> gÃ¼nlÃ¼k seri!</div>
      <div class="ring-wrapper">
        <svg width="180" height="180">
          <defs>
            <linearGradient id="grad"><stop offset="0%" stop-color="#8B5CF6"/><stop offset="100%" stop-color="#EC4899"/></linearGradient>
          </defs>
          <circle class="ring-bg" cx="90" cy="90" r="75"></circle>
          <circle id="ring" class="ring-progress" cx="90" cy="90" r="75" stroke-dasharray="471.2" stroke-dashoffset="471.2"></circle>
        </svg>
        <div class="ring-center">
          <div class="ring-value" id="totalCal">0</div>
          <div style="font-size:13px;color:var(--text-sec);font-weight:500">kalori</div>
        </div>
      </div>
      <div style="display:flex;justify-content:center;gap:20px;font-size:14px;color:var(--text-sec);margin-bottom:25px">
        <div>Kalan: <span style="font-weight:600;color:var(--primary)" id="remaining">2000</span></div>
        <div>Hedef: <span style="font-weight:600;color:var(--primary)" id="goal">2000</span></div>
      </div>
      <div class="macros">
        <div class="macro">
          <div class="macro-icon">ğŸ¥©</div>
          <div class="macro-val" id="protein">0</div>
          <div style="font-size:12px;color:var(--text-sec);margin-bottom:10px">Protein (g)</div>
          <div style="font-size:11px;color:var(--primary);font-weight:600" id="proteinPct">0%</div>
          <div class="macro-bar"><div class="macro-fill protein" id="proteinBar" style="width:0%"></div></div>
        </div>
        <div class="macro">
          <div class="macro-icon">ğŸ</div>
          <div class="macro-val" id="carbs">0</div>
          <div style="font-size:12px;color:var(--text-sec);margin-bottom:10px">Karb. (g)</div>
          <div style="font-size:11px;color:var(--primary);font-weight:600" id="carbsPct">0%</div>
          <div class="macro-bar"><div class="macro-fill carbs" id="carbsBar" style="width:0%"></div></div>
        </div>
        <div class="macro">
          <div class="macro-icon">ğŸ¥‘</div>
          <div class="macro-val" id="fat">0</div>
          <div style="font-size:12px;color:var(--text-sec);margin-bottom:10px">YaÄŸ (g)</div>
          <div style="font-size:11px;color:var(--primary);font-weight:600" id="fatPct">0%</div>
          <div class="macro-bar"><div class="macro-fill fat" id="fatBar" style="width:0%"></div></div>
        </div>
      </div>
    </div>

    <div class="section-title">HÄ±zlÄ± Ä°ÅŸlemler</div>
    <div class="quick-actions">
      <div class="action primary" onclick="switchTab('add')">
        <div class="action-icon">ğŸ“¸</div>
        <div style="font-size:16px;font-weight:700;margin-bottom:4px">Yemek Ekle</div>
        <div style="font-size:13px;opacity:0.8">AI Analiz</div>
      </div>
      <div class="action blue" onclick="switchTab('favorites')">
        <div class="action-icon">â­</div>
        <div style="font-size:16px;font-weight:700;margin-bottom:4px">Favoriler</div>
        <div style="font-size:13px;opacity:0.8">HÄ±zlÄ± Ekle</div>
      </div>
      <div class="action green" onclick="switchTab('recipes')">
        <div class="action-icon">ğŸ‘¨â€ğŸ³</div>
        <div style="font-size:16px;font-weight:700;margin-bottom:4px">Tarifler</div>
        <div style="font-size:13px;opacity:0.8">100+ tarif</div>
      </div>
      <div class="action" onclick="startBarcode()">
        <div class="action-icon">ğŸ“Š</div>
        <div style="font-size:16px;font-weight:700;margin-bottom:4px">Barkod</div>
        <div style="font-size:13px;opacity:0.8">Tara</div>
      </div>
    </div>

    <div class="section-title">BugÃ¼nkÃ¼ Yemekler</div>
    <div id="todayMeals"></div>
  </div>

  <div id="waterTab" class="tab">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <h2 class="card-title">ğŸ’§ Su Takibi</h2>
        <div style="font-size:32px;font-weight:800;color:#3B82F6"><span id="waterAmt">0</span>L</div>
      </div>
      <div class="water-glasses" id="waterGlasses"></div>
      <div style="text-align:center;font-size:14px;color:var(--text-sec);margin:20px 0">
        Hedef: <span style="font-weight:600;color:#3B82F6" id="waterGoal">2.5</span>L
      </div>
    </div>
  </div>

  <div id="weightTab" class="tab">
    <div class="card">
      <h2 class="card-title">âš–ï¸ AÄŸÄ±rlÄ±k Takibi</h2>
      <div class="weight-entry">
        <input type="number" id="weightInput" class="input" placeholder="Kilo (kg)" step="0.1">
        <button class="btn btn-primary" onclick="addWeight()">Ekle</button>
      </div>
      <div class="stat-grid">
        <div class="stat">
          <div class="stat-val" id="currentWeight">-</div>
          <div class="stat-label">GÃ¼ncel Kilo</div>
        </div>
        <div class="stat">
          <div class="stat-val" id="weightChange">-</div>
          <div class="stat-label">DeÄŸiÅŸim</div>
        </div>
      </div>
      <div class="chart-container">
        <canvas id="weightChart"></canvas>
      </div>
    </div>

    <div class="card">
      <h2 class="card-title">ğŸ’ª VÃ¼cut Ã–lÃ§Ã¼leri</h2>
      <input type="number" id="waist" class="input" placeholder="Bel (cm)" style="margin-bottom:15px">
      <input type="number" id="chest" class="input" placeholder="GÃ¶ÄŸÃ¼s (cm)" style="margin-bottom:15px">
      <input type="number" id="arm" class="input" placeholder="Kol (cm)" style="margin-bottom:15px">
      <button class="btn btn-success" onclick="saveMeasurements()">ğŸ’¾ Kaydet</button>
    </div>
  </div>

  <div id="addTab" class="tab">
    <div class="card">
      <h2 class="card-title">ğŸ“¸ Yemek Ekle</h2>
      <div class="meal-sel">
        <button class="meal-opt sel" data-meal="breakfast">
          <div style="font-size:24px;margin-bottom:6px">ğŸŒ…</div>
          <div style="font-size:12px;font-weight:600">KahvaltÄ±</div>
        </button>
        <button class="meal-opt" data-meal="lunch">
          <div style="font-size:24px;margin-bottom:6px">â˜€ï¸</div>
          <div style="font-size:12px;font-weight:600">Ã–ÄŸle</div>
        </button>
        <button class="meal-opt" data-meal="dinner">
          <div style="font-size:24px;margin-bottom:6px">ğŸŒ™</div>
          <div style="font-size:12px;font-weight:600">AkÅŸam</div>
        </button>
        <button class="meal-opt" data-meal="snack">
          <div style="font-size:24px;margin-bottom:6px">ğŸª</div>
          <div style="font-size:12px;font-weight:600">AtÄ±ÅŸtÄ±r.</div>
        </button>
      </div>
      <div class="upload-methods">
        <div class="upload-method" onclick="document.getElementById('camera').click()">
          <div style="font-size:36px;margin-bottom:10px">ğŸ“·</div>
          <div style="font-size:14px;font-weight:700">FotoÄŸraf Ã‡ek</div>
        </div>
        <div class="upload-method" onclick="document.getElementById('gallery').click()">
          <div style="font-size:36px;margin-bottom:10px">ğŸ–¼ï¸</div>
          <div style="font-size:14px;font-weight:700">Galeriden SeÃ§</div>
        </div>
      </div>
      <input type="file" id="camera" class="hidden" accept="image/*" capture="environment">
      <input type="file" id="gallery" class="hidden" accept="image/*">
      <div id="barcodeScanner" class="hidden">
        <div style="position:relative;width:100%;height:300px;background:#000;border-radius:16px;overflow:hidden">
          <video id="scannerVideo" style="width:100%;height:100%;object-fit:cover"></video>
        </div>
        <button class="btn btn-danger" style="margin-top:15px" onclick="stopBarcode()">âŒ Durdur</button>
      </div>
      <div class="preview" id="preview">
        <img id="previewImg" class="preview-img">
        <button class="btn btn-primary" id="analyzeBtn">ğŸ¤– AI ile Analiz Et</button>
      </div>
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div style="font-size:16px;color:var(--text-sec);font-weight:500">AI analiz ediyor...</div>
      </div>
      <div class="result" id="result">
        <div class="result-head">
          <div class="result-name" id="resName">-</div>
          <div class="result-score">â­ <span id="resScore">0</span>/10</div>
        </div>
        <div class="nutrition">
          <div class="nut-item">
            <div style="font-size:28px;margin-bottom:8px">ğŸ”¥</div>
            <div class="nut-val"><span id="resCal">0</span></div>
            <div style="font-size:12px;color:var(--text-sec)">Kalori</div>
          </div>
          <div class="nut-item">
            <div style="font-size:28px;margin-bottom:8px">ğŸ¥©</div>
            <div class="nut-val"><span id="resProtein">0</span>g</div>
            <div style="font-size:12px;color:var(--text-sec)">Protein</div>
          </div>
          <div class="nut-item">
            <div style="font-size:28px;margin-bottom:8px">ğŸ</div>
            <div class="nut-val"><span id="resCarbs">0</span>g</div>
            <div style="font-size:12px;color:var(--text-sec)">Karbonhidrat</div>
          </div>
          <div class="nut-item">
            <div style="font-size:28px;margin-bottom:8px">ğŸ¥‘</div>
            <div class="nut-val"><span id="resFat">0</span>g</div>
            <div style="font-size:12px;color:var(--text-sec)">YaÄŸ</div>
          </div>
        </div>
        <div class="ai-box">
          <div class="ai-head"><span>ğŸ’¡</span><span>AI Uzman Yorumu</span></div>
          <div style="color:#1E3A8A;font-size:14px;line-height:1.7" id="resComment">-</div>
        </div>
        <textarea id="foodNotes" class="input" style="min-height:80px;margin-bottom:15px" placeholder="ğŸ“ NotlarÄ±nÄ±z"></textarea>
        <button class="btn btn-success" id="saveFood">âœ… Kaydet</button>
        <button class="btn" style="background:var(--bg);color:var(--text);margin-top:10px" onclick="addToFavorites()">â­ Favorilere Ekle</button>
      </div>
    </div>
  </div>

  <div id="favoritesTab" class="tab">
    <div class="card">
      <h2 class="card-title">â­ Favori Yemekler</h2>
      <div class="fav-grid" id="favGrid"></div>
    </div>
  </div>

  <div id="recipesTab" class="tab">
    <div class="card">
      <h2 class="card-title">ğŸ‘¨â€ğŸ³ SaÄŸlÄ±klÄ± Tarifler</h2>
      <input type="text" id="recipeSearch" class="input" placeholder="ğŸ” Tarif ara..." oninput="filterRecipes()" style="margin-bottom:15px">
      <div class="recipe-grid" id="recipeGrid"></div>
    </div>
  </div>

  <div id="statsTab" class="tab">
    <div class="card">
      <h2 class="card-title">ğŸ“Š HaftalÄ±k Ä°lerleme</h2>
      <div class="chart-container">
        <canvas id="weekChart"></canvas>
      </div>
    </div>
    <div class="card">
      <h2 class="card-title">ğŸ† BaÅŸarÄ± Rozetleri</h2>
      <div style="display:flex;flex-wrap:wrap;gap:10px;justify-content:center" id="badges"></div>
    </div>
    <div class="card">
      <h2 class="card-title">ğŸ“ˆ Ä°statistikler</h2>
      <div class="stat-grid">
        <div class="stat">
          <div class="stat-val" id="totalEntries">0</div>
          <div class="stat-label">Toplam KayÄ±t</div>
        </div>
        <div class="stat">
          <div class="stat-val" id="avgCal">0</div>
          <div class="stat-label">Ort. Kalori</div>
        </div>
        <div class="stat">
          <div class="stat-val" id="bestStreak">0</div>
          <div class="stat-label">En Uzun Seri</div>
        </div>
        <div class="stat">
          <div class="stat-val" id="favFood">-</div>
          <div class="stat-label">En Ã‡ok Yenen</div>
        </div>
      </div>
    </div>
  </div>

  <div id="settingsTab" class="tab">
    <div class="card">
      <h2 class="card-title">ğŸ‘¤ Profil</h2>
      <div style="text-align:center;margin-bottom:20px">
        <img id="profilePic" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23E5E7EB'/%3E%3Ctext x='50' y='65' font-size='40' text-anchor='middle' fill='%236B7280'%3EğŸ‘¤%3C/text%3E%3C/svg%3E" class="profile-pic">
        <button style="background:var(--bg);border:none;padding:10px 20px;border-radius:50px;font-weight:600;cursor:pointer" onclick="document.getElementById('profilePicInput').click()">ğŸ“¸ FotoÄŸraf DeÄŸiÅŸtir</button>
        <input type="file" id="profilePicInput" class="hidden" accept="image/*">
      </div>
      <input type="text" id="userName" class="input" placeholder="Ä°sminiz" style="margin-bottom:15px">
      <button class="btn btn-primary" onclick="saveProfile()">ğŸ’¾ Profili Kaydet</button>
    </div>

    <div class="card">
      <h2 class="card-title">ğŸ¯ Hedefler</h2>
      <input type="number" id="goalCal" class="input" placeholder="Kalori" value="2000" style="margin-bottom:15px">
      <input type="number" id="goalProtein" class="input" placeholder="Protein (g)" value="150" style="margin-bottom:15px">
      <input type="number" id="goalCarbs" class="input" placeholder="Karb (g)" value="200" style="margin-bottom:15px">
      <input type="number" id="goalFat" class="input" placeholder="YaÄŸ (g)" value="60" style="margin-bottom:15px">
      <input type="number" id="goalWater" class="input" placeholder="Su (L)" value="2.5" step="0.1" style="margin-bottom:15px">
      <button class="btn btn-success" onclick="saveGoals()">ğŸ’¾ Hedefleri Kaydet</button>
    </div>

    <div class="card">
      <h2 class="card-title">â° HatÄ±rlatÄ±cÄ±lar</h2>
      <div class="reminder-item">
        <div>
          <div style="font-weight:600">ğŸ’§ Su HatÄ±rlatÄ±cÄ±</div>
          <div style="font-size:12px;color:var(--text-sec)">Her 2 saatte</div>
        </div>
        <div class="toggle" id="waterReminder" onclick="toggleReminder('water')">
          <div class="toggle-btn"></div>
        </div>
      </div>
      <div class="reminder-item">
        <div>
          <div style="font-weight:600">ğŸ½ï¸ Ã–ÄŸÃ¼n HatÄ±rlatÄ±cÄ±</div>
          <div style="font-size:12px;color:var(--text-sec)">Ã–ÄŸÃ¼n saatleri</div>
        </div>
        <div class="toggle" id="mealReminder" onclick="toggleReminder('meal')">
          <div class="toggle-btn"></div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 class="card-title">ğŸ¨ GÃ¶rÃ¼nÃ¼m</h2>
      <div class="reminder-item">
        <div>
          <div style="font-weight:600">ğŸŒ™ KaranlÄ±k Mod</div>
        </div>
        <div class="toggle" id="darkToggle" onclick="toggleDarkMode()">
          <div class="toggle-btn"></div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 class="card-title">âš ï¸ Veri YÃ¶netimi</h2>
      <button class="btn btn-danger" onclick="clearAll()">ğŸ—‘ï¸ TÃ¼m Verileri Sil</button>
    </div>
  </div>
</div>

<div id="recipeModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="recipeTitle">Tarif</h3>
      <button class="close-btn" onclick="closeModal('recipeModal')">âœ•</button>
    </div>
    <div class="modal-body" id="recipeBody"></div>
  </div>
</div>

<div class="bottom-nav">
  <button class="nav-item active" onclick="switchTab('home')">
    <div class="nav-icon">ğŸ </div>
    <div class="nav-label">Ana Sayfa</div>
  </button>
  <button class="nav-item" onclick="switchTab('water')">
    <div class="nav-icon">ğŸ’§</div>
    <div class="nav-label">Su</div>
  </button>
  <button class="nav-item" onclick="switchTab('add')">
    <div class="nav-icon">â•</div>
    <div class="nav-label">Ekle</div>
  </button>
  <button class="nav-item" onclick="switchTab('weight')">
    <div class="nav-icon">âš–ï¸</div>
    <div class="nav-label">AÄŸÄ±rlÄ±k</div>
  </button>
  <button class="nav-item" onclick="switchTab('stats')">
    <div class="nav-icon">ğŸ“Š</div>
    <div class="nav-label">Ä°statistik</div>
  </button>
</div>

<script>
const API='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';
let meal='breakfast',photo=null,data=[],water=[],weight=[],favs=[],reminders={water:false,meal:false},goals={calories:2000,protein:150,carbs:200,fat:60,water:2.5},profile={name:'',photo:null},measurements={waist:0,chest:0,arm:0};
const badges=[
{id:'first',name:'Ä°lk AdÄ±m',icon:'ğŸ¯',desc:'Ä°lk yemek',req:()=>data.length>=1},
{id:'week',name:'1 Hafta',icon:'ğŸ“…',desc:'7 gÃ¼nlÃ¼k seri',req:()=>getStreak()>=7},
{id:'month',name:'1 Ay',icon:'ğŸ—“ï¸',desc:'30 gÃ¼nlÃ¼k seri',req:()=>getStreak()>=30},
{id:'water',name:'Su Åampiyonu',icon:'ğŸ’§',desc:'GÃ¼nlÃ¼k su hedefi',req:()=>false},
{id:'healthy',name:'SaÄŸlÄ±k UzmanÄ±',icon:'ğŸ¥—',desc:'50 saÄŸlÄ±klÄ± yemek',req:()=>data.filter(x=>x.score>=7).length>=50}
];
const recipes=[
{name:"Kinoa SalatasÄ±",emoji:"ğŸ¥—",cal:320,protein:12,carbs:45,fat:10,ing:["Kinoa","Domates"],ins:"PiÅŸirin."},
{name:"Izgara Tavuk",emoji:"ğŸ—",cal:165,protein:31,carbs:0,fat:3.6,ing:["Tavuk"],ins:"Izgara yapÄ±n."},
{name:"Yulaf LapasÄ±",emoji:"ğŸ¥£",cal:150,protein:5,carbs:27,fat:3,ing:["Yulaf"],ins:"PiÅŸirin."},
{name:"Avokado Toast",emoji:"ğŸ¥‘",cal:280,protein:8,carbs:30,fat:15,ing:["Ekmek","Avokado"],ins:"KÄ±zartÄ±n."},
{name:"Somon",emoji:"ğŸŸ",cal:367,protein:39,carbs:0,fat:22,ing:["Somon"],ins:"FÄ±rÄ±nlayÄ±n."}
];
for(let i=0;i<95;i++)recipes.push({name:`Tarif ${i+6}`,emoji:["ğŸ¥—","ğŸ²","ğŸ³"][i%3],cal:200+Math.random()*300|0,protein:10+Math.random()*25|0,carbs:20+Math.random()*50|0,fat:5+Math.random()*20|0,ing:["Malzeme"],ins:"PiÅŸirin."});

let charts={week:null,weight:null};

document.addEventListener('DOMContentLoaded',()=>{
  load();updateDate();initUpload();initWater();initProfile();updateUI();
  setTimeout(initCharts,100);
  loadRecipes();loadFavorites();loadBadges();
  if(localStorage.getItem('darkMode')==='true')toggleDarkMode();
});

function load(){
  try{
    data=JSON.parse(localStorage.getItem('calorieData')||'[]');
    water=JSON.parse(localStorage.getItem('waterData')||'[]');
    weight=JSON.parse(localStorage.getItem('weightData')||'[]');
    favs=JSON.parse(localStorage.getItem('favorites')||'[]');
    reminders=JSON.parse(localStorage.getItem('reminders')||'{}');
    const g=JSON.parse(localStorage.getItem('goals')||'null');
    if(g)goals=g;
    const p=JSON.parse(localStorage.getItem('profile')||'null');
    if(p)profile=p;
    const m=JSON.parse(localStorage.getItem('measurements')||'null');
    if(m)measurements=m;
    document.getElementById('goalCal').value=goals.calories;
    document.getElementById('goalProtein').value=goals.protein;
    document.getElementById('goalCarbs').value=goals.carbs;
    document.getElementById('goalFat').value=goals.fat;
    document.getElementById('goalWater').value=goals.water;
    document.getElementById('userName').value=profile.name;
    if(profile.photo)document.getElementById('profilePic').src=profile.photo;
    document.getElementById('waist').value=measurements.waist;
    document.getElementById('chest').value=measurements.chest;
    document.getElementById('arm').value=measurements.arm;
    if(reminders.water)document.getElementById('waterReminder').classList.add('on');
    if(reminders.meal)document.getElementById('mealReminder').classList.add('on');
  }catch(e){console.error(e)}
}

function save(key,val){localStorage.setItem(key,JSON.stringify(val))}

function updateDate(){
  document.getElementById('date').textContent=new Date().toLocaleDateString('tr-TR',{weekday:'long',day:'numeric',month:'long'});
}

function initWater(){
  const c=document.getElementById('waterGlasses');
  for(let i=0;i<10;i++){
    const g=document.createElement('div');
    g.className='glass';
    g.innerHTML='ğŸ’§';
    g.onclick=()=>toggleWater(i);
    c.appendChild(g);
  }
  updateWater();
}

function toggleWater(i){
  const t=new Date().toDateString();
  const w=water.filter(x=>new Date(x.date).toDateString()===t);
  if(w.length>i){
    water=water.filter((x,idx)=>!(new Date(x.date).toDateString()===t&&idx>=water.findIndex(y=>new Date(y.date).toDateString()===t)+i&&idx<water.findIndex(y=>new Date(y.date).toDateString()===t)+i+1));
  }else{
    water.push({date:new Date().toISOString(),amount:0.25});
  }
  save('waterData',water);
  updateWater();
}

function updateWater(){
  const t=new Date().toDateString();
  const w=water.filter(x=>new Date(x.date).toDateString()===t);
  document.getElementById('waterAmt').textContent=(w.length*0.25).toFixed(1);
  document.getElementById('waterGoal').textContent=goals.water;
  document.querySelectorAll('.glass').forEach((g,i)=>g.classList.toggle('filled',i<w.length));
}

function initProfile(){
  document.getElementById('profilePicInput').addEventListener('change',e=>{
    const f=e.target.files[0];
    if(f){
      const r=new FileReader();
      r.onload=e=>{
        profile.photo=e.target.result;
        document.getElementById('profilePic').src=e.target.result;
      };
      r.readAsDataURL(f);
    }
  });
}

function saveProfile(){
  profile.name=document.getElementById('userName').value;
  save('profile',profile);
  toast('âœ… Profil kaydedildi!');
}

function initUpload(){
  const h=e=>{
    const f=e.target.files[0];
    if(f){
      const r=new FileReader();
      r.onload=e=>{
        photo=e.target.result;
        document.getElementById('previewImg').src=photo;
        document.getElementById('preview').classList.add('show');
        document.getElementById('barcodeScanner').classList.add('hidden');
      };
      r.readAsDataURL(f);
    }
  };
  document.getElementById('camera').addEventListener('change',h);
  document.getElementById('gallery').addEventListener('change',h);
  document.getElementById('analyzeBtn').addEventListener('click',analyze);
  document.getElementById('saveFood').addEventListener('click',saveFood);
  document.querySelectorAll('.meal-opt').forEach(b=>b.addEventListener('click',function(){
    document.querySelectorAll('.meal-opt').forEach(x=>x.classList.remove('sel'));
    this.classList.add('sel');
    meal=this.dataset.meal;
  }));
}

function startBarcode(){
  switchTab('add');
  const s=document.getElementById('barcodeScanner');
  s.classList.remove('hidden');
  document.getElementById('preview').classList.remove('show');
  if(typeof Quagga!=='undefined'){
    Quagga.init({
      inputStream:{name:"Live",type:"LiveStream",target:document.querySelector('#scannerVideo')},
      decoder:{readers:["ean_reader","code_128_reader"]}
    },err=>{
      if(err){toast('âŒ Kamera hatasÄ±');return;}
      Quagga.start();
    });
    Quagga.onDetected(d=>{
      stopBarcode();
      const db={'8690632006857':{foodName:'Ãœlker Ã‡ikolata',calories:220,protein:3,carbs:25,fat:12,score:4,comment:'TatlÄ± iÃ§in uygun.'}};
      const p=db[d.codeResult.code];
      if(p)showResult(p);
      else toast('âš ï¸ Barkod bulunamadÄ±');
    });
  }else toast('âŒ TarayÄ±cÄ± yÃ¼klenemedi');
}

function stopBarcode(){
  if(typeof Quagga!=='undefined')Quagga.stop();
  document.getElementById('barcodeScanner').classList.add('hidden');
}

async function analyze(){
  if(!photo)return;
  const l=document.getElementById('loading');
  const r=document.getElementById('result');
  const b=document.getElementById('analyzeBtn');
  l.classList.add('show');
  r.classList.remove('show');
  b.disabled=true;
  try{
    const img=photo.split(',')[1];
    if(!img)throw new Error('GeÃ§ersiz fotoÄŸraf');
    const res=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{'Content-Type':'application/json','x-api-key':API,'anthropic-version':'2023-06-01'},
      body:JSON.stringify({
        model:'claude-3-5-sonnet-20241022',
        max_tokens:1024,
        messages:[{
          role:'user',
          content:[
            {type:'image',source:{type:'base64',media_type:'image/jpeg',data:img}},
            {type:'text',text:'Bu yemek fotoÄŸrafÄ±nÄ± analiz et ve JSON ver:\n{"foodName":"ad","calories":sayÄ±,"protein":sayÄ±,"carbs":sayÄ±,"fat":sayÄ±,"score":1-10,"comment":"TÃ¼rkÃ§e yorum"}\nSadece JSON.'}
          ]
        }]
      })
    });
    if(!res.ok)throw new Error(`API: ${res.status}`);
    const d=await res.json();
    const m=d.content[0].text.match(/\{[\s\S]*\}/);
    if(!m)throw new Error('JSON bulunamadÄ±');
    showResult(JSON.parse(m[0]));
  }catch(e){
    toast('âŒ Hata: '+e.message);
    l.classList.remove('show');
  }finally{
    b.disabled=false;
  }
}

function showResult(r){
  document.getElementById('loading').classList.remove('show');
  document.getElementById('resName').textContent=r.foodName||r.name;
  document.getElementById('resScore').textContent=r.score;
  document.getElementById('resCal').textContent=r.calories;
  document.getElementById('resProtein').textContent=r.protein;
  document.getElementById('resCarbs').textContent=r.carbs;
  document.getElementById('resFat').textContent=r.fat;
  document.getElementById('resComment').textContent=r.comment||'GÃ¼zel!';
  window.cur={...r,foodName:r.foodName||r.name,image:photo};
  document.getElementById('result').classList.add('show');
}

function saveFood(){
  if(!window.cur)return;
  const notes=document.getElementById('foodNotes').value;
  data.push({id:Date.now(),date:new Date().toISOString(),meal,...window.cur,notes});
  save('calorieData',data);
  document.getElementById('result').classList.remove('show');
  document.getElementById('preview').classList.remove('show');
  document.getElementById('camera').value='';
  document.getElementById('gallery').value='';
  document.getElementById('foodNotes').value='';
  photo=null;
  window.cur=null;
  updateUI();
  switchTab('home');
  toast('âœ… Kaydedildi!');
}

function addToFavorites(){
  if(!window.cur)return;
  favs.push({...window.cur});
  save('favorites',favs);
  loadFavorites();
  toast('â­ Favorilere eklendi!');
}

function loadFavorites(){
  const g=document.getElementById('favGrid');
  if(!favs.length){
    g.innerHTML='<div class="empty"><div class="empty-icon">â­</div><div>Favori yok</div></div>';
    return;
  }
  g.innerHTML=favs.map((f,i)=>`<div class="fav-card" onclick="addFavorite(${i})"><div style="font-size:36px;margin-bottom:10px">ğŸ½ï¸</div><div style="font-weight:700;margin-bottom:4px">${f.foodName}</div><div style="font-size:12px;color:var(--text-sec)">${f.calories} kcal</div></div>`).join('');
}

function addFavorite(i){
  const f=favs[i];
  data.push({id:Date.now(),date:new Date().toISOString(),meal,...f});
  save('calorieData',data);
  updateUI();
  switchTab('home');
  toast('âœ… Eklendi!');
}

function addWeight(){
  const v=parseFloat(document.getElementById('weightInput').value);
  if(!v)return;
  weight.push({date:new Date().toISOString(),value:v});
  save('weightData',weight);
  document.getElementById('weightInput').value='';
  updateWeight();
  toast('âœ… Kilo kaydedildi!');
}

function updateWeight(){
  if(!weight.length){
    document.getElementById('currentWeight').textContent='-';
    document.getElementById('weightChange').textContent='-';
    return;
  }
  const cur=weight[weight.length-1].value;
  document.getElementById('currentWeight').textContent=cur.toFixed(1)+' kg';
  if(weight.length>1){
    const prev=weight[weight.length-2].value;
    const diff=cur-prev;
    document.getElementById('weightChange').textContent=(diff>=0?'+':'')+diff.toFixed(1)+' kg';
  }
  updateWeightChart();
}

function saveMeasurements(){
  measurements={
    waist:parseFloat(document.getElementById('waist').value)||0,
    chest:parseFloat(document.getElementById('chest').value)||0,
    arm:parseFloat(document.getElementById('arm').value)||0
  };
  save('measurements',measurements);
  toast('âœ… Ã–lÃ§Ã¼ler kaydedildi!');
}

function updateUI(){
  updateMacros();
  updateToday();
  updateStats();
  updateWater();
  updateWeight();
  loadBadges();
}

function updateMacros(){
  const t=new Date().toDateString();
  const d=data.filter(x=>new Date(x.date).toDateString()===t);
  const c=d.reduce((s,x)=>s+x.calories,0);
  const pr=d.reduce((s,x)=>s+x.protein,0);
  const ca=d.reduce((s,x)=>s+x.carbs,0);
  const f=d.reduce((s,x)=>s+x.fat,0);
  document.getElementById('totalCal').textContent=c;
  document.getElementById('protein').textContent=pr|0;
  document.getElementById('carbs').textContent=ca|0;
  document.getElementById('fat').textContent=f|0;
  document.getElementById('remaining').textContent=Math.max(0,goals.calories-c);
  document.getElementById('goal').textContent=goals.calories;
  const p=Math.min(c/goals.calories*100,100);
  const cir=2*Math.PI*75;
  document.getElementById('ring').style.strokeDashoffset=cir-(p/100)*cir;
  const prp=Math.min(pr/goals.protein*100,100);
  const cap=Math.min(ca/goals.carbs*100,100);
  const fp=Math.min(f/goals.fat*100,100);
  document.getElementById('proteinBar').style.width=prp+'%';
  document.getElementById('carbsBar').style.width=cap+'%';
  document.getElementById('fatBar').style.width=fp+'%';
  document.getElementById('proteinPct').textContent=(prp|0)+'%';
  document.getElementById('carbsPct').textContent=(cap|0)+'%';
  document.getElementById('fatPct').textContent=(fp|0)+'%';
  document.getElementById('streak').textContent=getStreak();
}

function getStreak(){
  let s=0;
  const t=new Date();
  for(let i=0;i<365;i++){
    const d=new Date(t);
    d.setDate(d.getDate()-i);
    if(data.some(x=>new Date(x.date).toDateString()===d.toDateString()))s++;
    else break;
  }
  return s;
}

function updateToday(){
  const t=new Date().toDateString();
  const d=data.filter(x=>new Date(x.date).toDateString()===t);
  const m={breakfast:{name:'KahvaltÄ±',icon:'ğŸŒ…',items:[]},lunch:{name:'Ã–ÄŸle',icon:'â˜€ï¸',items:[]},dinner:{name:'AkÅŸam',icon:'ğŸŒ™',items:[]},snack:{name:'AtÄ±ÅŸtÄ±rma',icon:'ğŸª',items:[]}};
  d.forEach(x=>m[x.meal]&&m[x.meal].items.push(x));
  let h='';
  Object.entries(m).forEach(([k,v])=>{
    if(v.items.length>0){
      const tot=v.items.reduce((s,x)=>s+x.calories,0);
      h+=`<div style="margin-bottom:25px"><div style="display:flex;justify-content:space-between;margin-bottom:12px"><div style="font-size:18px;font-weight:700">${v.icon} ${v.name}</div><div style="font-size:16px;font-weight:700;color:var(--primary)">${tot} kcal</div></div>`;
      v.items.forEach(x=>{
        h+=`<div class="food-card"><div class="food-img-wrap">${x.image?`<img src="${x.image}" class="food-img">`:'<div class="food-placeholder">ğŸ½ï¸</div>'}</div><div class="food-info"><div class="food-name">${x.foodName}</div><div class="food-macros"><span>ğŸ¥© ${x.protein}g</span><span>ğŸ ${x.carbs}g</span><span>ğŸ¥‘ ${x.fat}g</span></div><div class="food-score">â­ ${x.score}/10</div></div><div style="display:flex;flex-direction:column;align-items:flex-end;justify-content:space-between"><div class="food-cal">${x.calories}</div><button class="del-btn" onclick="del(${x.id})">ğŸ—‘ï¸</button></div></div>`;
      });
      h+='</div>';
    }
  });
  document.getElementById('todayMeals').innerHTML=h||'<div class="empty"><div class="empty-icon">ğŸ½ï¸</div><div>Yemek yok</div></div>';
}

function del(id){
  if(confirm('Silmek istediÄŸine emin misin?')){
    data=data.filter(x=>x.id!==id);
    save('calorieData',data);
    updateUI();
  }
}

function updateStats(){
  document.getElementById('totalEntries').textContent=data.length;
  const t=data.reduce((s,x)=>s+x.calories,0);
  document.getElementById('avgCal').textContent=data.length>0?(t/data.length|0):0;
  document.getElementById('bestStreak').textContent=getStreak();
  const foods={};
  data.forEach(x=>{
    foods[x.foodName]=(foods[x.foodName]||0)+1;
  });
  const fav=Object.entries(foods).sort((a,b)=>b[1]-a[1])[0];
  document.getElementById('favFood').textContent=fav?fav[0]:'-';
}

function initCharts(){
  const w=document.getElementById('weekChart');
  const wt=document.getElementById('weightChart');
  if(!w||!wt)return;
  charts.week=new Chart(w,{
    type:'line',
    data:{labels:[],datasets:[{label:'Kalori',data:[],borderColor:'#8B5CF6',backgroundColor:'rgba(139,92,246,0.1)',tension:0.4,fill:true}]},
    options:{responsive:true,maintainAspectRatio:true,plugins:{legend:{display:false}}}
  });
  charts.weight=new Chart(wt,{
    type:'line',
    data:{labels:[],datasets:[{label:'Kilo',data:[],borderColor:'#EC4899',backgroundColor:'rgba(236,72,153,0.1)',tension:0.4,fill:true}]},
    options:{responsive:true,maintainAspectRatio:true,plugins:{legend:{display:false}}}
  });
  updateWeekChart();
  updateWeightChart();
}

function updateWeekChart(){
  if(!charts.week)return;
  const d=[];
  for(let i=6;i>=0;i--){
    const dt=new Date();
    dt.setDate(dt.getDate()-i);
    d.push(dt.toDateString());
  }
  const l=d.map(x=>new Date(x).toLocaleDateString('tr-TR',{weekday:'short'}));
  const v=d.map(x=>data.filter(y=>new Date(y.date).toDateString()===x).reduce((s,y)=>s+y.calories,0));
  charts.week.data.labels=l;
  charts.week.data.datasets[0].data=v;
  charts.week.update();
}

function updateWeightChart(){
  if(!charts.weight)return;
  const l=weight.slice(-30).map(x=>new Date(x.date).toLocaleDateString('tr-TR',{day:'numeric',month:'short'}));
  const v=weight.slice(-30).map(x=>x.value);
  charts.weight.data.labels=l;
  charts.weight.data.datasets[0].data=v;
  charts.weight.update();
}

function loadRecipes(){
  const g=document.getElementById('recipeGrid');
  g.innerHTML=recipes.map((r,i)=>`<div class="recipe-card" onclick="showRecipe(${i})"><div class="recipe-img">${r.emoji}</div><div class="recipe-info"><div style="font-size:14px;font-weight:700;margin-bottom:6px">${r.name}</div><div style="font-size:11px;color:var(--text-sec)">ğŸ”¥ ${r.cal} kcal</div></div></div>`).join('');
}

function filterRecipes(){
  const q=document.getElementById('recipeSearch').value.toLowerCase();
  const filtered=recipes.filter(r=>r.name.toLowerCase().includes(q));
  const g=document.getElementById('recipeGrid');
  g.innerHTML=filtered.map((r,i)=>`<div class="recipe-card" onclick="showRecipe(${recipes.indexOf(r)})"><div class="recipe-img">${r.emoji}</div><div class="recipe-info"><div style="font-size:14px;font-weight:700;margin-bottom:6px">${r.name}</div><div style="font-size:11px;color:var(--text-sec)">ğŸ”¥ ${r.cal} kcal</div></div></div>`).join('');
}

function showRecipe(i){
  const r=recipes[i];
  document.getElementById('recipeTitle').textContent=r.name;
  document.getElementById('recipeBody').innerHTML=`<div style="text-align:center;font-size:72px;margin-bottom:20px">${r.emoji}</div><h4>ğŸ“Š Besin DeÄŸerleri</h4><div style="background:var(--bg);padding:15px;border-radius:12px;margin:15px 0"><div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px"><div>ğŸ”¥ ${r.cal} kcal</div><div>ğŸ¥© ${r.protein}g</div><div>ğŸ ${r.carbs}g</div><div>ğŸ¥‘ ${r.fat}g</div></div></div><h4>ğŸ›’ Malzemeler</h4><ul style="margin:15px 0">${r.ing.map(x=>`<li>${x}</li>`).join('')}</ul><h4>ğŸ‘¨â€ğŸ³ HazÄ±rlanÄ±ÅŸ</h4><p style="margin-top:10px">${r.ins}</p>`;
  document.getElementById('recipeModal').classList.add('show');
}

function closeModal(id){
  document.getElementById(id).classList.remove('show');
}

function loadBadges(){
  const g=document.getElementById('badges');
  g.innerHTML=badges.map(b=>`<div class="badge ${b.req()?'':'locked'}"><div class="badge-icon">${b.icon}</div><div class="badge-name">${b.name}</div><div style="font-size:11px;color:var(--text-sec);text-align:center">${b.desc}</div></div>`).join('');
}

function saveGoals(){
  goals={
    calories:+document.getElementById('goalCal').value,
    protein:+document.getElementById('goalProtein').value,
    carbs:+document.getElementById('goalCarbs').value,
    fat:+document.getElementById('goalFat').value,
    water:+document.getElementById('goalWater').value
  };
  save('goals',goals);
  updateUI();
  toast('âœ… Hedefler kaydedildi!');
}

function toggleDarkMode(){
  document.body.dataset.theme=document.body.dataset.theme==='dark'?'':'dark';
  document.getElementById('darkToggle').classList.toggle('on');
  localStorage.setItem('darkMode',document.body.dataset.theme==='dark');
}

function toggleReminder(t){
  reminders[t]=!reminders[t];
  document.getElementById(t+'Reminder').classList.toggle('on');
  save('reminders',reminders);
  if(reminders[t]&&Notification.permission==='default')Notification.requestPermission();
  toast(`âœ… ${t==='water'?'Su':'Ã–ÄŸÃ¼n'} hatÄ±rlatÄ±cÄ±sÄ± ${reminders[t]?'aÃ§Ä±ldÄ±':'kapandÄ±'}!`);
}

function clearAll(){
  if(confirm('âš ï¸ TÃœM VERÄ°LERÄ° SÄ°LMEK EMÄ°N MÄ°SÄ°N?')){
    localStorage.clear();
    location.reload();
  }
}

function switchTab(t){
  document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  document.getElementById(t+'Tab').classList.add('active');
  const m={home:0,water:1,add:2,weight:3,stats:4};
  if(m[t]!==undefined)document.querySelectorAll('.nav-item')[m[t]].classList.add('active');
  if(t==='stats'&&charts.week)updateWeekChart();
  if(t==='weight'&&charts.weight){updateWeight();updateWeightChart();}
  if(t==='recipes')loadRecipes();
  if(t==='favorites')loadFavorites();
}

function toast(msg){
  const t=document.createElement('div');
  t.style.cssText='position:fixed;top:20px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#10B981,#059669);color:white;padding:16px 24px;border-radius:12px;font-weight:600;z-index:9999;box-shadow:0 10px 30px rgba(16,185,129,0.4)';
  t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),3000);
}

console.log('ğŸš€ Kalori Pro Premium v2.0 HazÄ±r!');
</script>
</body>
</html>
